<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="https://q2.qlogo.cn/headimg_dl?dst_uin=2973517380&spec=5">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name='description' content='一个二次元随机美图站点'>
    <title>Pic~Onani~API~</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .content {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #333;
        }
        p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 2rem;
        }
        .btn {
            display: inline-block;
            background-color: #007bff;
            color: #fff;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            text-decoration: none;
            transition: background-color 0.3s ease;
            margin: 0 10px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .scroll-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            animation: scroll 180s linear infinite;
        }
        .row {
            display: flex;
            justify-content: flex-start;
            width: 120%;
            margin-bottom: 5px;
        }
        .row:nth-child(even) {
            transform: translateX(-10%);
        }
        .scroll-container img {
            width: calc(20% - 5px);
            height: 300px;
            object-fit: cover;
            margin-right: 5px;
            opacity: 0.7;
            border-radius: 15px;
        }
        @keyframes scroll {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-50%);
            }
        }
    </style>
</head>
<body>
    <div class="background">
        <div class="scroll-container">
            <!-- Images will be inserted here by JavaScript -->
        </div>
    </div>

    <div class="content">
        <h1>欢迎来到随机图站点</h1>
        <p>这是一个 Onani 的随机图站点，使用 <a title="点我前往图源" href="https://ipfs-pic.onani.cn"target="_blank">IPFS</a> 服务。<br> 为了便于传输，使用了WEBP压缩技术。<br>  <b>特别鸣谢：锦瑟、瑞希</b>~</p>
        <div>
            <a href="/v.html" class="btn" id="verticalBtn" target="_blank">竖屏随机图</a>
            <a href="/h.html" class="btn" id="horizontalBtn" target="_blank">横屏随机图</a>
        </div>
    </div>

    <script>
        const scrollContainer = document.querySelector('.scroll-container');
        const imagesPerRow = 6;
        const rowCount = 4;
    
        const ipfsBaseUrl = 'https://ipfs-pic.onani.cn/ri/';
        const verticalDir = 'v/';
        const horizontalDir = 'h/';
    
        let verticalImages = [];
        let horizontalImages = [];
    
        async function fetchImageList(dir) {
    const response = await fetch(`${ipfsBaseUrl}${dir}`);
    const data = await response.text();
    const parser = new DOMParser();
    const htmlDocument = parser.parseFromString(data, 'text/html');
    const links = Array.from(htmlDocument.querySelectorAll('a'));

    return links
        .map(link => link.getAttribute('href'))
        .filter(href => href && href.endsWith('.webp')) // 只保留以.webp结尾的文件
        .map(href => {
            const url = new URL(href, ipfsBaseUrl + dir);
            const filename = url.pathname.split('/').pop(); // 获取文件名
            // 只保留没有CID的文件名（即不包含"bafy"或"bafk"）
            return filename.includes('bafy') || filename.includes('bafk') ? null : filename; 
        })
        .filter(filename => filename !== null); // 移除null
}

    
        async function initializeImages() {
            verticalImages = await fetchImageList(verticalDir);
            horizontalImages = await fetchImageList(horizontalDir);
            populateImages(true); // Default to vertical images
        }
    
        function getRandomImageUrl(isVertical) {
            const images = isVertical ? verticalImages : horizontalImages;
            const randomIndex = Math.floor(Math.random() * images.length);
            return `${ipfsBaseUrl}${isVertical ? verticalDir : horizontalDir}${images[randomIndex]}`;
        }
    
        function createImageElement(isVertical) {
            const img = document.createElement('img');
            img.src = getRandomImageUrl(isVertical);
            img.alt = "Random Image";
            return img;
        }
    
        function populateImages(isVertical) {
            scrollContainer.innerHTML = ''; // Clear existing images
            for (let i = 0; i < rowCount * 2; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                for (let j = 0; j < imagesPerRow; j++) {
                    row.appendChild(createImageElement(isVertical)); // Pass the flag for vertical/horizontal
                }
                scrollContainer.appendChild(row);
            }
        }
    
        //document.getElementById('verticalBtn').addEventListener('click', (e) => {
            // e.preventDefault();
            // populateImages(true); // Repopulate with vertical images
        // });
    
        // document.getElementById('horizontalBtn').addEventListener('click', (e) => {
            // e.preventDefault();
            // populateImages(false); // Use horizontal images
        // });
    
        // Initialize images on page load
        initializeImages();
    </script>
    
</body>
</html>
